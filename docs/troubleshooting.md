# 트러블슈팅

## 개요

이 문서는 AI Startup Investment Evaluator 프로젝트에서 발생한 실제 문제와 해결 과정, 그리고 그 과정에서 배운 점을 정리합니다.

## 문제 1: 여러 Agent가 생성한 정보 누락 문제

### 문제 상황

보고서 생성 시 State에 저장된 정보가 일부 누락되는 문제가 발생했습니다. 특히 시장성 평가나 경쟁사 분석 결과가 보고서에 반영되지 않는 경우가 있었습니다.

**증상**:
- 보고서에 시장성 평가 결과가 누락됨
- 경쟁사 분석 내용이 보고서에 포함되지 않음
- 일부 기업 정보가 보고서에 반영되지 않음

**영향**:
- 불완전한 보고서 생성
- 투자 의사결정에 필요한 정보 부족
- 시스템 신뢰성 저하

### 원인 분석

**근본 원인**:
1. **State key 불일치**: 각 에이전트가 사용하는 State key가 일관되지 않음
   - `market_eval_agent`는 `market_analysis` 사용
   - `competitor_analysis_agent`는 `competitor_analysis` 사용
   - 하지만 보고서 생성 노드에서 다른 key 이름을 참조하는 경우 발생

2. **데이터 검증 부재**: 보고서 생성 노드에서 State에 데이터가 존재하는지 검증하지 않음
   - 데이터가 없어도 에러 없이 진행
   - 누락된 정보를 인지하지 못함

3. **비동기 처리 문제**: 여러 에이전트가 비동기로 실행되면서 State 업데이트 타이밍 이슈
   - 일부 에이전트의 결과가 State에 저장되기 전에 보고서 생성 시도

### 해결 과정

#### 1단계: State key 사용 현황 조사
- 모든 에이전트의 State key 사용 현황을 조사
- 보고서 생성 노드에서 참조하는 key와 실제 저장된 key 비교
- 불일치하는 key 목록 정리

#### 2단계: 표준 State key 명명 규칙 정의
- 모든 에이전트가 사용할 표준 State key 명명 규칙 정의
- 명명 규칙 문서화
- 예시:
  - `market_analysis`: 시장성 평가 결과
  - `competitor_analysis`: 경쟁사 분석 결과
  - `investment_decision`: 투자 의사결정 결과

#### 3단계: 각 에이전트의 State key 수정
- 모든 에이전트의 State key를 표준에 맞게 수정
- 기존 코드와의 호환성 확인
- 테스트를 통한 검증

#### 4단계: 보고서 생성 노드에 명시적 데이터 검증 로직 추가
- State에 필수 데이터가 존재하는지 검증
- 누락된 데이터에 대한 에러 처리
- 로깅을 통한 디버깅 정보 제공

**구현 예시**:
```python
# 필수 데이터 검증
required_keys = ['market_analysis', 'competitor_analysis', 'investment_decision']
missing_keys = [key for key in required_keys if key not in state or not state[key]]

if missing_keys:
    logger.warning(f"Missing required data: {missing_keys}")
    # 기본값 설정 또는 에러 처리
```

### 결과

**해결 결과**:
- 모든 에이전트의 분석 결과가 보고서에 반영됨
- 데이터 일관성 확보로 안정성 향상
- 명시적 데이터 검증으로 누락 문제 조기 발견 가능

**성과**:
- 보고서 생성 성공률: 100% (모든 에이전트 결과 반영)
- 데이터 일관성: State key 표준화로 일관성 확보
- 시스템 안정성: 명시적 검증 로직으로 안정성 향상

### 배운 점

1. **표준화의 중요성**: 여러 에이전트가 협업하는 시스템에서는 표준화가 필수
2. **명시적 검증**: 데이터 검증 로직을 명시적으로 추가하면 문제를 조기 발견 가능
3. **문서화**: State key 명명 규칙을 문서화하면 유지보수성 향상
4. **로깅**: 디버깅 정보를 로깅하면 문제 해결 시간 단축

---

## 문제 2: 논리적 연결성 부족 문제

### 문제 상황

산업 분석 → 기업 분석 → 평가의 논리적 연결이 어색한 문제가 발생했습니다. 각 섹션이 독립적으로 작성되어 전체적인 흐름이 부족했습니다.

**증상**:
- 산업 분석 섹션과 기업 분석 섹션이 논리적으로 연결되지 않음
- 각 섹션이 독립적으로 작성되어 전체적인 스토리 부족
- 보고서를 읽을 때 흐름이 끊기는 느낌

**영향**:
- 전문가 수준의 보고서가 되지 않음
- 보고서의 신뢰성 저하
- 투자 의사결정에 도움이 되지 않는 보고서

### 원인 분석

**근본 원인**:
1. **프롬프트 구조 부족**: LLM에 전달하는 프롬프트가 각 섹션을 독립적으로 작성하도록 지시
   - 산업 분석과 기업 분석의 연결성을 고려하지 않음
   - 전체적인 스토리텔링 구조 부재

2. **보고서 템플릿 부재**: 구조화된 보고서 템플릿이 없어 일관성 부족
   - 각 실행마다 다른 형식의 보고서 생성
   - 섹션 간 연결 문구 부재

3. **컨텍스트 전달 부족**: 이전 섹션의 내용을 다음 섹션에서 참조하지 않음
   - 각 섹션이 독립적으로 작성됨
   - 전체적인 맥락 부족

### 해결 과정

#### 1단계: 전문가 수준의 투자 보고서 구조 분석
- 실제 VC 투자 보고서 구조 분석
- 논리적 흐름 파악
- 각 섹션 간 연결 방식 이해

#### 2단계: 논리적 흐름을 고려한 보고서 템플릿 설계
- 산업 분석 → 기업 분석 → 평가의 논리적 흐름 설계
- 각 섹션의 역할과 목적 명확화
- 섹션 간 연결 문구 설계

**보고서 구조**:
1. **Executive Summary**: 핵심 내용 요약
2. **Industry Analysis**: 산업 동향 분석 (전체 맥락 제공)
3. **Company Overview**: 기업 개요 (산업 맥락과 연결)
4. **Market Evaluation**: 시장성 평가 (산업 분석과 기업 정보 종합)
5. **Competitive Analysis**: 경쟁사 분석 (시장성 평가와 연결)
6. **Investment Decision**: 투자 의사결정 (모든 분석 종합)
7. **Recommendations**: 최종 권고사항

#### 3단계: 프롬프트에 섹션 간 연결 문구 포함
- 각 섹션 작성 시 이전 섹션 내용 참조하도록 지시
- 섹션 간 연결 문구 예시 제공
- 전체적인 스토리텔링 구조 고려

**프롬프트 예시**:
```
산업 분석 섹션을 작성한 후, 기업 개요 섹션에서는 다음과 같이 연결하세요:
"앞서 분석한 [산업명] 산업의 동향을 바탕으로, [기업명]은 다음과 같은 특징을 가지고 있습니다."

시장성 평가 섹션에서는 산업 분석과 기업 정보를 종합하여 평가하세요.
```

#### 4단계: 메타 프롬프트 추가
- 전체적인 일관성 유지를 위한 메타 프롬프트 추가
- 보고서 전체의 스토리텔링 구조 고려
- 각 섹션이 전체 맥락에 맞게 작성되도록 지시

### 결과

**해결 결과**:
- 자연스러운 흐름의 전문가 수준 보고서 생성
- 각 섹션 간 논리적 연결성 강화
- 전체적인 스토리텔링 구조 확보

**성과**:
- 보고서 품질: 전문가 수준의 논리적 흐름 확보
- 일관성: 구조화된 템플릿으로 일관성 있는 보고서 생성
- 사용자 만족도: 읽기 쉬운 보고서로 만족도 향상

### 배운 점

1. **구조화된 템플릿의 중요성**: 구조화된 템플릿이 일관성 있는 결과를 만드는 데 필수
2. **논리적 흐름 설계**: 보고서는 단순한 정보 나열이 아닌 논리적 스토리텔링이 중요
3. **프롬프트 엔지니어링**: 섹션 간 연결성을 고려한 프롬프트 설계가 품질 향상에 중요
4. **컨텍스트 전달**: 이전 섹션의 내용을 다음 섹션에서 참조하면 전체적인 맥락 확보 가능

---

## 문제 3: 데이터 일관성 부족 문제

### 문제 상황

기업 태그 기반 경쟁사 비교 시 데이터 일관성 부족 문제가 발생했습니다. 개별 태그 비교로 인한 정확도 저하가 있었습니다.

**증상**:
- 태그 기반 경쟁사 선정 시 정확도 저하
- 유사한 태그를 가진 기업이 경쟁사로 선정되지 않음
- 태그 불일치로 인한 경쟁사 누락

**영향**:
- 경쟁사 분석의 정확도 저하
- 투자 의사결정에 필요한 정보 부족
- 시스템 신뢰성 저하

### 원인 분석

**근본 원인**:
1. **개별 태그 비교**: 개별 태그를 비교하여 경쟁사를 선정
   - 유사한 의미의 태그를 다른 태그로 인식
   - 태그 그룹 단위 비교 부재

2. **태그 표준화 부재**: 태그 명명 규칙이 일관되지 않음
   - 동일한 의미의 태그가 다른 이름으로 저장됨
   - 태그 그룹화 로직 부재

3. **벡터 유사도 검색 한계**: 벡터 유사도만으로는 태그 그룹 단위 비교 어려움
   - 개별 태그의 의미를 고려하지 않음
   - 태그 그룹의 맥락 부족

### 해결 과정

#### 1단계: 태그 그룹 단위 비교 방식 설계
- 유사한 의미의 태그를 그룹화
- 태그 그룹 단위로 경쟁사 비교
- 태그 그룹 매핑 테이블 생성

**태그 그룹 예시**:
- 모빌리티 그룹: ["전기차", "전동킥보드", "자율주행", "모빌리티"]
- 헬스케어 그룹: ["의료", "헬스케어", "바이오", "의료기기"]

#### 2단계: 태그 그룹 매핑 로직 구현
- 태그를 그룹으로 매핑하는 로직 구현
- 태그 그룹 기반 경쟁사 검색
- 벡터 유사도와 태그 그룹을 결합한 검색

#### 3단계: 경쟁사 분석 에이전트와 협업
- 경쟁사 분석 에이전트와 협업하여 데이터 일관성 확보
- 태그 그룹 단위 비교 로직 통합
- 테스트를 통한 검증

### 결과

**해결 결과**:
- 경쟁사 분석의 정확도 및 일관성 향상
- 태그 그룹 단위 비교로 정확도 향상
- 데이터 일관성 확보

**성과**:
- 경쟁사 선정 정확도: 태그 그룹 단위 비교로 향상
- 데이터 일관성: 태그 그룹 매핑으로 일관성 확보
- 시스템 신뢰성: 정확한 경쟁사 분석으로 신뢰성 향상

### 배운 점

1. **그룹화의 중요성**: 개별 항목 비교보다 그룹 단위 비교가 정확도 향상에 도움
2. **협업의 중요성**: 여러 에이전트와의 협업을 통해 데이터 일관성 확보
3. **맥락 고려**: 개별 태그보다 태그 그룹의 맥락을 고려하면 정확도 향상
4. **표준화**: 태그 그룹 매핑 테이블을 표준화하면 일관성 확보 가능

---

## 종합 배운 점

### 1. 표준화의 중요성
- 여러 에이전트가 협업하는 시스템에서는 표준화가 필수
- State key, 태그 명명 규칙 등을 표준화하면 일관성 확보 가능

### 2. 명시적 검증의 필요성
- 데이터 검증 로직을 명시적으로 추가하면 문제를 조기 발견 가능
- 에러 핸들링을 통한 안정성 향상

### 3. 구조화된 설계의 중요성
- 구조화된 템플릿, 프롬프트가 일관성 있는 결과를 만드는 데 필수
- 논리적 흐름을 고려한 설계가 품질 향상에 중요

### 4. 협업과 소통
- 여러 에이전트와의 협업을 통해 데이터 일관성 확보
- 표준화된 인터페이스 설계가 협업 효율성 향상에 중요

### 5. 문서화의 가치
- 문제 해결 과정을 문서화하면 향후 유사 문제 해결 시간 단축
- 명명 규칙, 템플릿 등을 문서화하면 유지보수성 향상

